///|
pub const NETHER_SPIRE_SIZE : Int = 17

///|
pub const NETHER_SPIRE_HEIGHT : Int = 35

///|
pub const NETHER_SPIRE_LAYER_Y_MIN : Int = -4

///|
/// Blueprint mark
const BP_NETHERRACK : UInt16 = 'N'

///|
let bp_netherrack : String = BP_NETHERRACK.to_char().unwrap().to_string()

///|
let filled_line : String = bp_netherrack.repeat(NETHER_SPIRE_SIZE)

///|
let filled_layer : Array[String] = @util.repeat(filled_line, NETHER_SPIRE_SIZE)

///|
let hollow_layer : Array[String] = [
  filled_line,
  ..@util.repeat(
    bp_netherrack + " ".repeat(NETHER_SPIRE_SIZE - 2) + bp_netherrack,
    NETHER_SPIRE_SIZE - 2,
  ),
  filled_line,
]

///|
let layers : Array[Array[String]] = [
  ..@util.repeat(filled_layer, 4),
  ..@util.repeat(hollow_layer, 4),
  filled_layer,
  hollow_layer,
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..NNNNNNNNNNN..N", "N...............N", "N...............N",
    "NNNNNNNNNNNNNNNNN",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..NNNNNNNNNNN..N", "N..............NN", "N.............NNN",
    "NNNNNNNNNNNNNNNN.",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N.NN", "N..NNNNNNNNNNNNNN", "N............NNN.", "N...........NNN..",
    "NNNNNNNNNNNNNN...",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N.NN", "N..N.........NNNN",
    "N..N.........NNN.", "N..NNNNNNNNNNNN..", "N..........NNN...", "N.........NNN....",
    "NNNNNNNNNNNN.....",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N..N", "N..N.........N..N",
    "N..N.........N.NN", "N..N.........NNNN", "N..N.........NNN.", "N..N........NNN..",
    "N..N.......NNN...", "N..NNNNNNNNNNN...", "N........NNN.....", "N.......NNN......",
    "NNNNNNNNNN.......",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N..N", "N..N.........N..N", "N..N.........N.NN", "N..N.........NNNN",
    "N..N.........NNN.", "N..N........NNN..", "N..N.......NNN...", "N..N......NNNN...",
    "N..N.....NNN.N...", "N..NNNNNNNNNNN...", "N......NNN.......", "N.....NNN........",
    "NNNNNNNN.........",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N...............N", "N..NNNNNNNNNNN..N",
    "N..N.........N.NN", "N..N.NNNNNNN.NNNN", "N..N.N.....N.NNN.", "N..N.N.....NNNN..",
    "N..N.N.....NNN...", "N..N.N....NNNN...", "N..N.N...NNN.N...", "N..N.NNNNNNN.N...",
    "N..N...NNN...N...", "N..NNNNNNNNNNN...", "N....NNN.........", "N...NNN..........",
    "NNNNNN...........",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N...............N", "N..............NN", "N..NNNNNNNNNNNNNN",
    "N..N.........NNN.", "N..N.NNNNNNNNNN..", "N..N.N.....NNN...", "N..N.N....NNNN...",
    "N..N.N...NNN.N...", "N..N.N..NNNN.N...", "N..N.N.NNN.N.N...", "N..N.NNNNNNN.N...",
    "N..N.NNN.....N...", "N..NNNNNNNNNNN...", "N..NNN...........", "N.NNN............",
    "NNNN.............",
  ],
  [
    "NNNNNNNNNNNNNNNNN", "N.............NNN", "N............NNN.", "N..NNNNNNNNNNNN..",
    "N..NN......NNN...", "N..N.NNNNNNNNN...", "N..N.N...NNN.N...", "N..N.N..NNNN.N...",
    "N..N.N.NNN.N.N...", "N..N.NNNN..N.N...", "N..N.NNN...N.N...", "N..NNNNNNNNN.N...",
    "N..NNN.......N...", "N.NNNNNNNNNNNN...", "NNNN.............", "NNN..............",
    "NN...............",
  ],
  [
    "NNNNNNNNNNNNNNNN.", "N...........NNN..", "N..........NNN...", "N....NNNNNNNNN...",
    "N...NNN..NNN.N...", "N..NNNNNNNNN.N...", "N..NNN.NNN.N.N...", "N..N.NNNN..N.N...",
    "N..N.NNN...N.N...", "N..NNNN....N.N...", "N..NNN.....N.N...", "N.NNNNNNNNNN.N...",
    "NNNN.........N...", "NNNNNNNNNNNNNN...", "NN...............", "N................",
    ".................",
  ],
  [
    "NNNNNNNNNNNNNN...", "N.........NNN....", "N........NNN.....", "N......NNNNNNN...",
    "N.....NNNN...N...", "N....NNNNNNN.N...", "N...NNNN...N.N...", "N..NNNN....N.N...",
    "N..NNN.....N.N...", "N.NNNN.....N.N...", "NNNN.N.....N.N...", "NNNN.NNNNNNN.N...",
    "NN.N.........N...", "N..NNNNNNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NNNNNNNNNNNN.....", "N.......NNN......", "N......NNN.......", "N.....NNNNNNNN...",
    "N....NNNNNN..N...", "N...NNNNNNNN.N...", "N..NNNNNN..N.N...", "N.NNNNNN...N.N...",
    "NNNNNNN....N.N...", "NNNNNN.....N.N...", "NN.NNN.....N.N...", "N..N.NNNNNNN.N...",
    "...N.........N...", "...NNNNNNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NNNNNNNNNN.......", "N.....NNN........", "N....NNN.........", "N...NNN....NNN...",
    "N..NNN....NNNN...", "N.NNNNNNNNNN.N...", "NNNN.N..NNNN.N...", "NNN..N.NNN.N.N...",
    "NN...NNNN..N.N...", "N....NNN...N.N...", "....NNN....N.N...", "...NNNNNNNNN.N...",
    "...NN........N...", "...NNNNNNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NNNNNNNN.........", "N...NNN..........", "N..NNN...........", "N.NNN........N...",
    "NNNN........NN...", "NNN..NNNNNNNNN...", "NN...N....NNNN...", "N....N...NNN.N...",
    ".....N..NNNN.N...", ".....N.NNN.N.N...", ".....NNNN..N.N...", ".....NNNNNNN.N...",
    "....NNN......N...", "...NNNNNNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NNNNNN...........", "N.NNN............", "NNNN.............", "NNN..............",
    "NN...............", "N....NNNNNNN.N...", ".....N.....NNN...", ".....N.....NNN...",
    ".....N....NNNN...", ".....N...NNN.N...", ".....N..NNNN.N...", ".....NNNNNNN.N...",
    "......NNN....N...", ".....NNNNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NNNN.............", "NNN..............", "NN...............", "N................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N.....N.N...",
    ".....N.....NNN...", ".....N.....NNN...", ".....N....NNNN...", ".....NNNNNNN.N...",
    "........NNN..N...", ".......NNNNNNN...", ".................", ".................",
    ".................",
  ],
  [
    "NN...............", "N................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N.....N.....",
    ".....N.....N.....", ".....N.....N.N...", ".....N.....NNN...", ".....NNNNNNNNN...",
    "..........NNNN...", ".........NNNNN...", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N.....N.....",
    ".....N.....N.....", ".....N.....N.....", ".....N.....N.....", ".....NNNNNNN.N...",
    "............NN...", "...........NNN...", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N.....N.....",
    ".....N.....N.....", ".....N.....N.....", ".....N.....N.....", ".....NNNNNNN.....",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N.....N.....",
    ".....N.....N.....", ".....N....NN.....", ".....N...NNN.....", ".....NNNNNN......",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N.....N.....", ".....N....NN.....",
    ".....N...NNN.....", ".....N..NNN......", ".....N.NNN.......", ".....NNNN........",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNNN.....", ".....N...NNN.....", ".....N..NNN......",
    ".....N.NNN.......", ".....NNNN........", ".....NNN.........", ".....NN..........",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNNNN......", ".....N.NNN.......", ".....NNNN........",
    ".....NNN.........", ".....NN..........", ".....N...........", ".................",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NNNN........", ".....NNN.........", ".....NN..........",
    ".....N...........", ".................", ".................", ".................",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
  [
    ".................", ".................", ".................", ".................",
    ".................", ".....NN..........", ".....N...........", ".................",
    ".................", ".................", ".................", ".................",
    ".................", ".................", ".................", ".................",
    ".................",
  ],
]

///|
/// Place a 17x35x17 netherrack spire from blueprint (no reactor core).
pub fn place_nether_spire(
  set_block : (Int, Int, Int, UInt) -> Unit,
  center_x : Int,
  base_y : Int,
  center_z : Int,
  filler? : @block.BlockId = @block.lookup_by_name("netherrack").unwrap().id,
) -> Unit {
  let air = @block.AIR_LONG_ID
  let half = NETHER_SPIRE_SIZE / 2
  let min_x = center_x - half
  let min_z = center_z - half
  for ly in 0..<layers.length() {
    let wy = base_y + NETHER_SPIRE_LAYER_Y_MIN + ly
    let layer = layers[ly]
    for lz in 0..<NETHER_SPIRE_SIZE {
      let row = layer[lz]
      for lx in 0..<NETHER_SPIRE_SIZE {
        let wx = min_x + lx
        let wz = min_z + lz
        let tile = if row[lx] == BP_NETHERRACK { filler } else { air }
        set_block(wx, wy, wz, tile)
      }
    }
  }
}
